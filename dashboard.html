<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Tribo do Cerrado</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Estilos adicionais para o sistema administrativo */
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #444;
        }

        .form-group input, .form-group select, .form-group textarea {
            padding: 8px;
            border: 2px solid #666;
            border-radius: 4px;
            background: #333;
            color: white;
            font-size: 1em;
            width: 100%;
            box-sizing: border-box;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #ff6b35;
            box-shadow: 0 0 5px rgba(255, 107, 53, 0.3);
        }

        .form-group small {
            display: block;
            margin-top: 5px;
            color: #ccc;
            font-size: 0.9em;
        }

        .password-requirements {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #666;
        }

        .password-requirements h4 {
            color: #ff6b35;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .password-requirements ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .password-requirements li {
            padding: 5px 0;
            font-size: 0.9em;
            transition: color 0.3s ease;
        }

        /* Estilos para temas */
        .tema-claro {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #212529;
        }

        .tema-claro .dashboard-container {
            background: rgba(255, 255, 255, 0.9);
            color: #212529;
        }

        .tema-claro .tab-button {
            background: linear-gradient(45deg, #6c757d, #495057);
            color: white;
        }

        .tema-claro .tab-content {
            background: rgba(255, 255, 255, 0.95);
            color: #212529;
        }

        /* Responsividade aprimorada */
        @media (max-width: 768px) {
            .tab-container {
                flex-direction: column;
                gap: 5px;
            }

            .tab-button {
                width: 100%;
                text-align: center;
            }

            .dashboard-container {
                margin: 10px;
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .dashboard-container {
                margin: 5px;
                padding: 10px;
            }

            .tab-button {
                padding: 10px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1>üèçÔ∏è TRIBO DO CERRADO</h1>
            <div class="user-info">
                <span id="user-name">Carregando...</span>
                <button class="logout-btn" onclick="logout()">üö™ Sair</button>
            </div>
        </div>

        <div class="tab-container">
            <button class="tab-button active" onclick="showDashboard()">üè† DASHBOARD</button>
            <button class="tab-button" onclick="showEventos()">üìÖ EVENTOS</button>
            <button class="tab-button" onclick="showEmail()">üìß EMAIL</button>
            <!-- Aba de administrador ser√° adicionada dinamicamente pelo JavaScript -->
            <button class="tab-button" onclick="showPerfil()">üë§ PERFIL</button>
        </div>

        <div class="content-container">
            <!-- Dashboard Principal -->
            <div id="dashboard-content" class="tab-content active">
                <h2>üìä Dashboard Principal</h2>
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-info">
                            <div class="stat-number" id="total-members">0</div>
                            <div class="stat-label">Membros Ativos</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìÖ</div>
                        <div class="stat-info">
                            <div class="stat-number" id="upcoming-events">0</div>
                            <div class="stat-label">Pr√≥ximos Eventos</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üèçÔ∏è</div>
                        <div class="stat-info">
                            <div class="stat-number" id="total-rides">0</div>
                            <div class="stat-label">Passeios Realizados</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-info">
                            <div class="stat-number" id="growth-rate">+0%</div>
                            <div class="stat-label">Crescimento</div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-widgets">
                    <div class="widget">
                        <h3>üìã Atividades Recentes</h3>
                        <div id="recent-activities">
                            <div class="activity-item">
                                <span class="activity-time">Hoje, 14:30</span>
                                <span class="activity-text">Novo membro cadastrado</span>
                            </div>
                            <div class="activity-item">
                                <span class="activity-time">Ontem, 16:45</span>
                                <span class="activity-text">Evento "Trilha do Cerrado" criado</span>
                            </div>
                            <div class="activity-item">
                                <span class="activity-time">2 dias atr√°s</span>
                                <span class="activity-text">5 novos participantes no evento</span>
                            </div>
                        </div>
                    </div>

                    <div class="widget">
                        <h3>üéØ Pr√≥ximos Eventos</h3>
                        <div id="upcoming-events-list">
                            <div class="event-preview">
                                <div class="event-date">15/01</div>
                                <div class="event-info">
                                    <div class="event-title">Encontro Mensal</div>
                                    <div class="event-location">Pra√ßa do Cerrado</div>
                                </div>
                            </div>
                            <div class="event-preview">
                                <div class="event-date">20/02</div>
                                <div class="event-info">
                                    <div class="event-title">Trilha do Cerrado</div>
                                    <div class="event-location">Chapada dos Veadeiros</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Eventos -->
            <div id="eventos-content" class="tab-content">
                <h2>üìÖ Gest√£o de Eventos</h2>
                <div class="eventos-container">
                    <div class="eventos-header">
                        <button class="btn-primary" onclick="criarEvento()">‚ûï Novo Evento</button>
                        <div class="eventos-filters">
                            <select id="filter-eventos">
                                <option value="todos">Todos os Eventos</option>
                                <option value="proximos">Pr√≥ximos</option>
                                <option value="passados">Passados</option>
                            </select>
                        </div>
                    </div>
                    <div id="eventos-list" class="eventos-grid">
                        <!-- Eventos ser√£o carregados aqui -->
                    </div>
                </div>
            </div>

            <!-- Email -->
            <div id="email-content" class="tab-content">
                <h2>üìß Sistema de Email</h2>
                <div class="email-container">
                    <div class="migadu-info">
                        <h3>üìÆ Configura√ß√£o Migadu</h3>
                        <div class="config-status">
                            <div class="status-item">
                                <span class="status-label">Dom√≠nio:</span>
                                <span class="status-value">tribodocerrado.org</span>
                                <span class="status-indicator pending">‚è≥ Configurando</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">API Key:</span>
                                <span class="status-value">Configurada</span>
                                <span class="status-indicator success">‚úÖ Ativo</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Caixas de Email:</span>
                                <span class="status-value">admin@tribodocerrado.org</span>
                                <span class="status-indicator success">‚úÖ Ativo</span>
                            </div>
                        </div>
                    </div>

                    <div class="email-actions">
                        <button class="btn-primary" onclick="enviarEmail()">üì§ Enviar Email</button>
                        <button class="btn-secondary" onclick="configurarMigadu()">‚öôÔ∏è Configurar</button>
                        <button class="btn-secondary" onclick="testarConexao()">üîç Testar Conex√£o</button>
                    </div>
                </div>
            </div>

            <!-- Perfil -->
            <div id="perfil-content" class="tab-content">
                <!-- Conte√∫do ser√° gerado pelo user-profile.js -->
            </div>

            <!-- Conte√∫do administrativo ser√° adicionado dinamicamente -->
        </div>
    </div>

    <!-- Scripts -->
    <script src="dashboard.js"></script>
    <script src="neon-integration.js"></script>
    <script src="migadu-integration.js"></script>
    <script src="admin-dashboard.js"></script>
    <script src="admin-functions.js"></script>
    <script src="user-profile.js"></script>
    <script src="user-profile-functions.js"></script>

    <script>
        // Inicializa√ß√£o do dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se usu√°rio est√° logado
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            if (!currentUser.email) {
                window.location.href = 'login.html';
                return;
            }

            // Atualizar informa√ß√µes do usu√°rio
            document.getElementById('user-name').textContent = currentUser.nome || currentUser.email;

            // Carregar dados do dashboard
            loadDashboardData();

            // Inicializar sistemas baseados no tipo de usu√°rio
            if (currentUser.email === 'admin@tribodocerrado.org' || currentUser.tipo === 'administrador') {
                // Usu√°rio administrador - sistemas completos ser√£o carregados pelo admin-dashboard.js
                console.log('Carregando sistemas administrativos...');
            } else {
                // Usu√°rio comum - apenas perfil ser√° carregado pelo user-profile.js
                console.log('Carregando sistemas de usu√°rio...');
            }

            // Aplicar tema salvo
            const preferencias = currentUser.preferencias_notificacao ? 
                JSON.parse(currentUser.preferencias_notificacao) : {};
            if (preferencias.tema) {
                aplicarTema(preferencias.tema);
            }
        });

        function loadDashboardData() {
            // Carregar estat√≠sticas
            const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
            const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');

            document.getElementById('total-members').textContent = usuarios.length;
            document.getElementById('upcoming-events').textContent = eventos.filter(e => new Date(e.data_evento) > new Date()).length;
            document.getElementById('total-rides').textContent = Math.floor(Math.random() * 50) + 10;
            document.getElementById('growth-rate').textContent = '+' + (Math.floor(Math.random() * 20) + 5) + '%';

            // Carregar eventos pr√≥ximos
            loadUpcomingEvents();
        }

        function loadUpcomingEvents() {
            const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
            const eventosProximos = eventos
                .filter(e => new Date(e.data_evento) > new Date())
                .sort((a, b) => new Date(a.data_evento) - new Date(b.data_evento))
                .slice(0, 3);

            const container = document.getElementById('upcoming-events-list');
            if (eventosProximos.length === 0) {
                container.innerHTML = '<p style="color: #ccc; text-align: center;">Nenhum evento pr√≥ximo</p>';
                return;
            }

            container.innerHTML = eventosProximos.map(evento => {
                const data = new Date(evento.data_evento);
                const dataFormatada = data.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
                
                return `
                    <div class="event-preview">
                        <div class="event-date">${dataFormatada}</div>
                        <div class="event-info">
                            <div class="event-title">${evento.titulo}</div>
                            <div class="event-location">${evento.local_evento || 'Local a definir'}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function aplicarTema(tema) {
            const body = document.body;
            
            // Remover classes de tema existentes
            body.classList.remove('tema-claro', 'tema-escuro', 'tema-auto');
            
            // Aplicar novo tema
            if (tema === 'claro') {
                body.classList.add('tema-claro');
            } else if (tema === 'escuro') {
                body.classList.add('tema-escuro');
            } else if (tema === 'auto') {
                body.classList.add('tema-auto');
                // Detectar prefer√™ncia do sistema
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    body.classList.add('tema-escuro');
                } else {
                    body.classList.add('tema-claro');
                }
            }
        }

        // Fun√ß√µes de navega√ß√£o (mantidas do dashboard original)
        function showDashboard() {
            hideAllTabs();
            document.getElementById('dashboard-content').style.display = 'block';
            setActiveTab(event.target);
        }

        function showEventos() {
            hideAllTabs();
            document.getElementById('eventos-content').style.display = 'block';
            setActiveTab(event.target);
            loadEventos();
        }

        function showEmail() {
            hideAllTabs();
            document.getElementById('email-content').style.display = 'block';
            setActiveTab(event.target);
        }

        function showPerfil() {
            hideAllTabs();
            document.getElementById('perfil-content').style.display = 'block';
            setActiveTab(event.target);
            
            // Garantir que o perfil seja carregado
            if (window.userProfile) {
                setTimeout(() => {
                    window.userProfile.enhanceProfileTab();
                }, 100);
            }
        }

        function hideAllTabs() {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
        }

        function setActiveTab(activeButton) {
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            activeButton.classList.add('active');
        }

        function loadEventos() {
            const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
            const container = document.getElementById('eventos-list');
            
            if (eventos.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #ccc; grid-column: 1 / -1;">Nenhum evento cadastrado</p>';
                return;
            }

            container.innerHTML = eventos.map(evento => {
                const data = new Date(evento.data_evento).toLocaleDateString('pt-BR');
                const status = new Date(evento.data_evento) > new Date() ? 'Pr√≥ximo' : 'Passado';
                
                return `
                    <div class="evento-card">
                        <h4>${evento.titulo}</h4>
                        <p><strong>üìÖ Data:</strong> ${data}</p>
                        <p><strong>üìç Local:</strong> ${evento.local_evento || 'A definir'}</p>
                        <p><strong>üìù Descri√ß√£o:</strong> ${evento.descricao || 'Sem descri√ß√£o'}</p>
                        <p><strong>üéØ Status:</strong> <span class="status-badge">${status}</span></p>
                        <div class="evento-actions">
                            <button class="btn-secondary" onclick="verEvento('${evento.id}')">üëÅÔ∏è Ver</button>
                            <button class="btn-primary" onclick="inscreverEvento('${evento.id}')">‚úÖ Inscrever</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function criarEvento() {
            // Verificar se √© administrador
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            if (currentUser.email !== 'admin@tribodocerrado.org' && currentUser.tipo !== 'administrador') {
                alert('Apenas administradores podem criar eventos.');
                return;
            }

            // Usar fun√ß√£o do admin se dispon√≠vel
            if (window.adminDashboard && window.adminDashboard.criarEvento) {
                window.adminDashboard.criarEvento();
            } else {
                alert('Sistema administrativo n√£o carregado.');
            }
        }

        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                localStorage.removeItem('currentUser');
                window.location.href = 'index.html';
            }
        }

        // Fun√ß√µes de email (placeholder)
        function enviarEmail() {
            alert('Funcionalidade de envio de email em desenvolvimento.');
        }

        function configurarMigadu() {
            alert('Configura√ß√£o Migadu em desenvolvimento.');
        }

        function testarConexao() {
            alert('Teste de conex√£o em desenvolvimento.');
        }

        // Fun√ß√µes de eventos (placeholder)
        function verEvento(id) {
            alert(`Visualizar evento ${id} - Em desenvolvimento`);
        }

        function inscreverEvento(id) {
            alert(`Inscrever no evento ${id} - Em desenvolvimento`);
        }
    </script>
</body>
</html>

