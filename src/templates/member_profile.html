{% extends "base_member.html" %}

{% block title %}Meu Perfil - Tribo do Cerrado{% endblock %}

{% block card_title %}Ficha de Membro{% endblock %}

{% block page_styles %}
.profile-content {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 20px;
}

.profile-section {
    grid-column: 1;
    grid-row: 1 / span 2;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.profile-image {
    width: 200px;
    height: 200px;
    object-fit: cover;
    border: 5px solid var(--dark-color);
    border-radius: 5px;
    margin-bottom: 20px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    transform: rotate(-3deg);
}

.profile-nickname {
    font-family: 'Black Ops One', cursive;
    font-size: 32px;
    color: var(--primary-color);
    text-align: center;
    margin-bottom: 10px;
    text-transform: uppercase;
    text-shadow: 1px 1px 0 var(--dark-color);
}

.profile-fullname {
    font-size: 18px;
    margin-bottom: 20px;
    text-align: center;
}

.profile-info {
    width: 100%;
    margin-top: 20px;
}

.info-item {
    display: flex;
    margin-bottom: 10px;
    border-bottom: 1px dotted var(--dark-gray);
    padding-bottom: 5px;
}

.info-label {
    font-weight: bold;
    min-width: 120px;
    color: var(--dark-gray);
}

.info-value {
    flex: 1;
}

.blood-type {
    display: inline-block;
    background-color: var(--primary-color);
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    font-weight: bold;
    margin-top: 10px;
}

.blood-type i {
    margin-right: 5px;
}

.godfather {
    margin-top: 20px;
    padding: 10px;
    background-color: rgba(255, 215, 0, 0.2);
    border-radius: 5px;
    border: 1px dashed var(--secondary-color);
}

.godfather-title {
    font-weight: bold;
    color: var(--dark-color);
    margin-bottom: 5px;
}

.address-section {
    grid-column: 2;
    grid-row: 1;
}

.address-form {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}

.form-group {
    margin-bottom: 10px;
}

.form-label {
    display: block;
    font-size: 12px;
    color: var(--dark-gray);
    margin-bottom: 3px;
}

.form-control {
    width: 100%;
    padding: 8px;
    border: 1px solid var(--dark-gray);
    border-radius: 3px;
    font-family: 'Roboto Mono', monospace;
    background-color: var(--light-gray);
}

.form-control:disabled {
    background-color: #f0f0f0;
    color: var(--dark-gray);
    border-style: dashed;
}

.form-group.street {
    grid-column: 1 / span 2;
}

.health-section {
    grid-column: 2;
    grid-row: 2;
}

.emergency-contacts {
    margin-top: 20px;
}

.contact-item {
    padding: 10px;
    background-color: var(--light-gray);
    border-radius: 5px;
    margin-bottom: 10px;
    border-left: 5px solid var(--primary-color);
}

.contact-name {
    font-weight: bold;
}

.contact-phone {
    color: var(--primary-color);
}

.contact-relation {
    font-style: italic;
    font-size: 14px;
    color: var(--dark-gray);
}

.edit-profile-button {
    display: inline-block;
    background-color: var(--secondary-color);
    color: var(--dark-color);
    padding: 10px 20px;
    border-radius: 5px;
    text-decoration: none;
    font-family: 'Black Ops One', cursive;
    margin-top: 20px;
    transition: background-color 0.3s;
    text-align: center;
}

.edit-profile-button:hover {
    background-color: #e6c200;
}

@media (max-width: 768px) {
    .profile-content {
        grid-template-columns: 1fr;
    }
    
    .profile-section {
        grid-column: 1;
        grid-row: 1;
    }
    
    .address-section {
        grid-column: 1;
        grid-row: 2;
    }
    
    .health-section {
        grid-column: 1;
        grid-row: 3;
    }
}
{% endblock %}

{% block content %}
<div class="card-section">
    <h2 class="section-title">
        <i class="fas fa-id-card"></i> Dados Pessoais
    </h2>
    
    <div class="profile-content">
        <div class="profile-section">
            <img src="{{ user.profile_image|default('/static/images/profiles/default.jpg') }}" alt="{{ user.nickname }}" class="profile-image" onerror="this.src='/static/images/profiles/default.jpg'">
            <h3 class="profile-nickname">{{ user.nickname }}</h3>
            <p class="profile-fullname">{{ user.full_name }}</p>
            
            <div class="blood-type">
                <i class="fas fa-tint"></i> {{ user.blood_type|default('Não informado') }}
            </div>
            
            <div class="profile-info">
                <div class="info-item">
                    <span class="info-label">Data de Nasc:</span>
                    <span class="info-value">{{ user.birth_date|date_format|default('Não informado') }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Coletamento:</span>
                    <span class="info-value">{{ user.collection_date|date_format|default('Não informado') }}</span>
                </div>
            </div>
            
            {% if godfather %}
            <div class="godfather">
                <div class="godfather-title">Padrinho:</div>
                <div>{{ godfather.nickname }}</div>
            </div>
            {% endif %}
            
            <a href="/membro/editar-perfil" class="edit-profile-button">
                <i class="fas fa-edit"></i> Editar Perfil
            </a>
        </div>
        
        <div class="address-section">
            <h3 class="section-title">
                <i class="fas fa-map-marker-alt"></i> Endereço
            </h3>
            
            <div class="address-form">
                <div class="form-group street">
                    <label class="form-label">Logradouro</label>
                    <input type="text" class="form-control" value="{{ user.address_street|default('') }}" disabled>
                </div>
                <div class="form-group">
                    <label class="form-label">Número</label>
                    <input type="text" class="form-control" value="{{ user.address_number|default('') }}" disabled>
                </div>
                <div class="form-group">
                    <label class="form-label">Complemento</label>
                    <input type="text" class="form-control" value="{{ user.address_complement|default('') }}" disabled>
                </div>
                <div class="form-group">
                    <label class="form-label">Bairro</label>
                    <input type="text" class="form-control" value="{{ user.address_district|default('') }}" disabled>
                </div>
                <div class="form-group">
                    <label class="form-label">Cidade</label>
                    <input type="text" class="form-control" value="{{ user.address_city|default('') }}" disabled>
                </div>
                <div class="form-group">
                    <label class="form-label">Estado</label>
                    <input type="text" class="form-control" value="{{ user.address_state|default('') }}" disabled>
                </div>
                <div class="form-group">
                    <label class="form-label">CEP</label>
                    <input type="text" class="form-control" value="{{ user.address_zipcode|default('') }}" disabled>
                </div>
            </div>
        </div>
        
        <div class="health-section">
            <h3 class="section-title">
                <i class="fas fa-heartbeat"></i> Saúde e Emergência
            </h3>
            
            <div class="form-group">
                <label class="form-label">Plano de Saúde</label>
                <input type="text" class="form-control" value="{{ user.health_insurance|default('') }}" disabled>
            </div>
            <div class="form-group">
                <label class="form-label">Número do Plano</label>
                <input type="text" class="form-control" value="{{ user.health_insurance_number|default('') }}" disabled>
            </div>
            <div class="form-group">
                <label class="form-label">Observações Médicas</label>
                <textarea class="form-control" disabled>{{ user.health_notes|default('') }}</textarea>
            </div>
            
            <h4 class="section-title" style="margin-top: 20px;">
                <i class="fas fa-phone-alt"></i> Contatos de Emergência
            </h4>
            
            {% if emergency_contacts %}
            <div class="emergency-contacts">
                {% for contact in emergency_contacts %}
                <div class="contact-item">
                    <div class="contact-name">{{ contact.name }}</div>
                    <div class="contact-phone">{{ contact.phone }}</div>
                    <div class="contact-relation">{{ contact.relationship }}</div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p>Nenhum contato de emergência cadastrado.</p>
            {% endif %}
        </div>
    </div>
</div>

<div class="card-section">
    <h2 class="section-title">
        <i class="fas fa-users"></i> Família
    </h2>
    
    {% if family_members %}
    <div class="family-members">
        {% for family_member in family_members %}
        <div class="family-item {% if family_member.relationship_type == 'spouse' %}spouse{% else %}child{% endif %}">
            <div class="family-type">
                {% if family_member.relationship_type == 'spouse' %}
                    Cônjuge
                {% elif family_member.relationship_type == 'son' %}
                    Filho
                {% elif family_member.relationship_type == 'daughter' %}
                    Filha
                {% else %}
                    {{ family_member.relationship_type }}
                {% endif %}
            </div>
            <div class="family-name">{{ family_member.name }}</div>
            {% if family_member.birth_date %}
            <div class="family-birth">
                <i class="fas fa-birthday-cake"></i> {{ family_member.birth_date|date_format }}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>Nenhum familiar cadastrado. <a href="/membro/familia/adicionar">Adicionar familiar</a></p>
    {% endif %}
</div>

<div class="card-section">
    <h2 class="section-title">
        <i class="fas fa-motorcycle"></i> Motocicletas
    </h2>
    
    {% if motorcycles %}
    <div class="motorcycle-list">
        {% for motorcycle in motorcycles %}
        <div class="motorcycle-item">
            {% if motorcycle.ipva_due_date and motorcycle.ipva_due_date|days_until < 30 %}
            <div class="ipva-alert">
                <i class="fas fa-exclamation-triangle"></i> IPVA vence em {{ motorcycle.ipva_due_date|days_until }} dias
            </div>
            {% endif %}
            
            <div class="motorcycle-header">
                <h3 class="motorcycle-title">{{ motorcycle.brand }} {{ motorcycle.model }}</h3>
                <div class="motorcycle-year">{{ motorcycle.model_year }}</div>
            </div>
            
            <div class="motorcycle-details">
                <div class="motorcycle-detail">
                    <span class="detail-label">Placa</span>
                    <div class="detail-value">{{ motorcycle.license_plate }}</div>
                </div>
                <div class="motorcycle-detail">
                    <span class="detail-label">Chassi</span>
                    <div class="detail-value">{{ motorcycle.chassis }}</div>
                </div>
                <div class="motorcycle-detail">
                    <span class="detail-label">Ano Fabricação</span>
                    <div class="detail-value">{{ motorcycle.manufacturing_year }}</div>
                </div>
                <div class="motorcycle-detail">
                    <span class="detail-label">Ano Modelo</span>
                    <div class="detail-value">{{ motorcycle.model_year }}</div>
                </div>
            </div>
            
            {% if motorcycle.images %}
            <div class="motorcycle-images">
                {% for image in motorcycle.images %}
                <div class="moto-image-container">
                    <img src="{{ image.image_url }}" alt="Foto {{ loop.index }}" class="moto-image">
                    <div class="moto-caption">{{ image.caption }}</div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>Nenhuma motocicleta cadastrada. <a href="/membro/motos/adicionar">Adicionar motocicleta</a></p>
    {% endif %}
</div>
{% endblock %}
